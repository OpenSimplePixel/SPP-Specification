# Simple Pixel Project (SPP) File Specification

> **Warning**: Simple Pixel is still under development, the specification of this file format may be changed anytime before the app is released.

## Introduction

### What is Simple Pixel?

**Simple Pixel** is a pixel art editing app for iOS, iPadOS, and macOS under development.

### What is the SPP file for?

The **SPP** file is a binary-based format for saving project data of Simple Pixel projects. It's designed for high-speed reading, writing, and lower storage usage.

## Basic Information

- Name: `Simple Pixel Project`
- File extension: `.spp`
- Identifier: `tw.justapple.spp`
- MIME: `application/x-spp`

## File Format

> **Note**: We use **little-endian** to encode all number fields.

| Name | Type | Information |
|---|---|---|
| Magic String | 4 Bytes | Always `SPPF` in ASCII. |
| File Version | UInt8 | Currently `1`. |
| Project Data (Compressed) | LZFSE Compressed Bytes | More details in the section below. |

### Project Data Format

| Name | Type | Information |
|---|---|---|
| Project Flags | 16 Bit Flags | Bit flag of this project, (`0b1`: higher color limit) |
| Author Name Length | UInt8 | Byte length of author name string. |
| Author Name | UTF-8 Bytes | Length depends on the previous field. |
| Project Description Length | UInt16 | Byte length of project description string. |
| Project Description | UTF-8 Bytes | Length depends on the previous field. |
| Canvas Width | UInt16 | Width of project canvas, of course, in pixels. When this field is `0`, the project will need to be initialized when opened. |
| Canvas Height | UInt16 | Height of project canvas, of course, in pixels too. When this field is `0`, the project will also need to be initialized when opened. |
| User Color Palette Color Count | UInt16 | The number of colors in the project's user color palette. |
| User Color Palette Colors | Array of Palette Color | Length depends on the previous field. More details in the section below. |
| Current Color | Palette Color| The last used color in this project. More details in the section below. |
| Color Index Color Count | UInt16 | The number of colors in the project's color index, generated by the system. |
| Color Index Colors | Array of UInt32 | Length depends on the previous field. Each color is encoded in RGBA (4*UInt8). |
| Animation Frame Count | UInt16 | The number of animation frames in this project. |
| Animation Frames | Array of Animation Frames | More details in the section below. |

### Palette Color Format

| Name | Type | Information |
|---|---|---|
| Gradient Direction | 4 Bits UInt | Only affects gradient colors, normal color will ignore this field. More details in the section below. |
| Flags | 4 Bits Flags | Bit flag of this color. (`0b1`: is gradient colors) |
| Color 1 | UInt32 RGBA Color (4*UInt8) | The start color of gradient or the actual color. |
| Color 2 | Optional UInt32 RGBA Color (4*UInt8) | The end color of gradient. Only exists for gradient colors. |

#### Gradient Direction

| Value | Direction |
|---|---|
| 0 | Bottom to top. |
| 1 | Left bottom to right top. |
| 2 | Left to right. |
| 3 | Left top to right bottom. |
| 4 | Top to bottom. |
| 5 | Top right to left bottom. |
| 6 | Right to left. |
| 7 | Right Bottom to left top. |

### Animation Frames Format

| Name | Type | Information |
|---|---|---|
| Duration | Double64 | The duration of this frame in seconds. |
| Layer Count | UInt16 | The number of layers in this frame. |
| Layers | Array of Layer | More details in the section below. |

### Layer

| Name | Type | Information |
|---|---|---|
| Flags | 16 Bits | Bit flag of this frame, (`0b1`: is hidden) |
| Pixel Data | Array of UInt8/UInt16 | Length of the array is **Canvas Width** \* **Canvas Height**. Each pixel's color is the ID of the color index (0\~255 or 0\~65535). |
